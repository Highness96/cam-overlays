<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Tip Wheel Overlay</title>

<style>
:root{
  --panel-bg: rgba(20, 0, 35, 0.65);
  --panel-border: rgba(180, 120, 255, 0.8);
  --glow: rgba(200, 140, 255, 1);
  --text: #ffffff;
  --accent1: #b86cff;
  --accent2: #6ee7ff;
}

html, body {
  margin: 0;
  padding: 0;
  background: transparent;
  overflow: hidden;
  font-family: Arial, Helvetica, sans-serif;
  color: var(--text);
}

/* OBS positioning */
#wrap {
  position: absolute;
  right: 40px;
  bottom: 40px;
  width: 900px;
  height: 900px;
  pointer-events: none;
}

#panel {
  position: absolute;
  inset: 0;
  background: var(--panel-bg);
  border-radius: 28px;
  border: 3px solid var(--panel-border);
  box-shadow:
    0 0 40px rgba(180,120,255,0.35),
    0 0 80px rgba(180,120,255,0.25);
}

/* Header */
#header {
  position: absolute;
  top: 18px;
  left: 24px;
  right: 24px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

#title {
  font-size: 28px;
  font-weight: 900;
  letter-spacing: 1px;
}

#cost {
  font-size: 20px;
  padding: 8px 14px;
  border-radius: 999px;
  background: rgba(0,0,0,0.4);
  border: 2px solid rgba(255,255,255,0.3);
}

/* Pointer */
#pointer {
  position: absolute;
  top: 115px;
  left: 50%;
  transform: translateX(-50%);
  width: 0;
  height: 0;
  border-left: 28px solid transparent;
  border-right: 28px solid transparent;
  border-bottom: 44px solid var(--accent2);
  filter: drop-shadow(0 0 15px rgba(110,231,255,0.9));
}

/* Canvas */
#canvas {
  position: absolute;
  left: 50%;
  top: 56%;
  transform: translate(-50%, -50%);
  width: 720px;
  height: 720px;
}

/* Result bar */
#result {
  position: absolute;
  left: 24px;
  right: 24px;
  bottom: 24px;
  padding: 18px 20px;
  font-size: 24px;
  border-radius: 18px;
  background: rgba(0,0,0,0.45);
  border: 2px solid rgba(255,255,255,0.25);
  display: flex;
  justify-content: space-between;
  align-items: center;
}

#result b {
  font-size: 26px;
}

.flash {
  animation: flash 0.9s ease-out;
}

@keyframes flash {
  0%   { box-shadow: 0 0 0 rgba(0,0,0,0); }
  30%  { box-shadow: 0 0 120px var(--glow); }
  100% { box-shadow: 0 0 40px rgba(180,120,255,0.4); }
}
</style>
</head>

<body>
<div id="wrap">
  <div id="panel"></div>

  <div id="header">
    <div id="title">TIP WHEEL</div>
    <div id="cost">Spin: <span id="spinCost">100</span> tokens</div>
  </div>

  <div id="pointer"></div>
  <canvas id="canvas" width="720" height="720"></canvas>

  <div id="result">
    <div>Result: <b id="lastResult">—</b></div>
    <div id="lastTip" style="opacity:.75;">waiting for tip…</div>
  </div>
</div>

<script>
const SPIN_COST = 100;
const ITEMS = [
  "Pull pants down (brief tease)",
  "Flash anything (5 seconds)",
  "Show feet",
  "I choose",
  "Grab my package",
  "Chat chooses next move",
  "Spin Again",
  "VIP attention moment"
];

const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");
const panel = document.getElementById("panel");
const lastResult = document.getElementById("lastResult");
const lastTip = document.getElementById("lastTip");
document.getElementById("spinCost").textContent = SPIN_COST;

let angle = 0;
let spinning = false;

function drawWheel() {
  const cx = canvas.width / 2;
  const cy = canvas.height / 2;
  const r = 330;
  const slice = (Math.PI * 2) / ITEMS.length;

  ctx.clearRect(0,0,canvas.width,canvas.height);

  ITEMS.forEach((text, i) => {
    const start = angle + i * slice;
    const end = start + slice;

    ctx.beginPath();
    ctx.moveTo(cx, cy);
    ctx.arc(cx, cy, r, start, end);
    ctx.fillStyle = i % 2 ? "rgba(110,231,255,0.35)" : "rgba(184,108,255,0.45)";
    ctx.fill();

    ctx.strokeStyle = "rgba(255,255,255,0.4)";
    ctx.lineWidth = 3;
    ctx.stroke();

    ctx.save();
    ctx.translate(cx, cy);
    ctx.rotate(start + slice / 2);
    ctx.textAlign = "right";
    ctx.font = "900 28px Arial";
    ctx.fillStyle = "#fff";
    ctx.shadowColor = "black";
    ctx.shadowBlur = 12;
    ctx.fillText(text, r - 20, 10);
    ctx.restore();
  });

  ctx.beginPath();
  ctx.arc(cx, cy, 70, 0, Math.PI * 2);
  ctx.fillStyle = "rgba(0,0,0,0.6)";
  ctx.fill();
  ctx.strokeStyle = "white";
  ctx.lineWidth = 3;
  ctx.stroke();

  ctx.fillStyle = "white";
  ctx.font = "900 22px Arial";
  ctx.textAlign = "center";
  ctx.textBaseline = "middle";
  ctx.fillText("SPIN", cx, cy);
}

drawWheel();

function spin(user, amount) {
  if (spinning) return;
  spinning = true;

  panel.classList.remove("flash");
  void panel.offsetWidth;
  panel.classList.add("flash");

  lastTip.textContent = `Tip ${amount} by ${user}`;

  const spins = 7 + Math.random() * 3;
  const final = angle + spins * Math.PI * 2 + Math.random() * Math.PI * 2;
  const start = performance.now();
  const dur = 5200;

  function ease(t){ return 1 - Math.pow(1 - t, 3); }

  function frame(now){
    const t = Math.min(1,(now-start)/dur);
    angle += (final-angle)*ease(t);
    drawWheel();
    if(t<1) requestAnimationFrame(frame);
    else{
      const index = Math.floor(((Math.PI*1.5 - angle + Math.PI*2)%(Math.PI*2)) / ((Math.PI*2)/ITEMS.length));
      lastResult.textContent = ITEMS[index];
      spinning = false;
    }
  }
  requestAnimationFrame(frame);
}

window.addEventListener("message", e=>{
  if(e.data?.type==="tip" && e.data.amount>=SPIN_COST){
    spin(e.data.user||"anon", e.data.amount);
  }
});
</script>
</body>
</html>

